# 视频会议系统家族认识

2020的疫情将远程办公推上了风口,
作为核心功能`视频会议系统`,是每个远程办公都要考虑的组件,
下面就从某些特定的角度来看看这些产品.

## 钉钉

### 安装第一印象

- 从安装的根目录看,启动和升级是分开
- 钉钉属于阿里系,相关的阿里认证sdk也是有的
- 基于cef
  - 理所当然
  - 如果不用webui,这么复杂的界面,估计得好几年
  - 如果考虑多平台,webui就是首选了
  - 期间还看到了directui的协议,那说明部分界面用了direct ui
- vs2010/vs2012,甚至vs2015+也用到了
- 配置使用的是xml格式,解析xml的是微软的msxml
- 国际化覆盖了 英语/日语/中国 还有几个我不知道的
- 还有个插件叫tblive
  - 里面有个封装了obs的项目
    - 里面有个叫conference应该是互动,live的应该是直播
  - 这基本上是将obs项目整个拖过来了,再基于obs做旁路部分
  - 最后,为啥没有obs的协议说明,同样是开源的,为啥cef就有

### 会议体验

- 采用的版本是windows版本客户端
- 开启一个会议,抓包显示走的是p2p,猜测应该是webrtc
- 整个cpu使用不高,画面质量一般,应该是分辨率和码率影响,帧率也不高
  - 但整体效果感人,说明参数的平衡找的好,换句话说就是项目经理厉害
- 信令和媒体都有做加密,毕竟大厂不差钱,安全还是要保障的
- 虽然走webrtc的流信息无法查看到,录制是可以看到的
  - 录制信息: h264/acc,1080p/20fps/码率1.5kbps
  - 走互动会议的数值肯定比上面的底
  - 互动上传摄像头带宽是70KBps,这个比录制时的200KBps小多了
  - 屏幕共享录制时,会录制3个文件:音频,视频flv,视频mp4
  - 不管是屏幕共享还是摄像头,录制时的参数都是一致的
- 会议这块优化的真不错,4%的cpu,录制会加10%,这是非常优秀的
- 因为整个测试的前置条件太复杂,没有多个手机无法测试,所以暂时不测试了

### 会议丢包体验

- 丢包在一定程度上是可接受的(不影响cpu和带宽)
- 丢包达到一个阀值后,业务逻辑会产于,重新建立连接
- 由于测试条件不足,也就没有继续分析重新推流后的流质量

### live体验

- 上面说到除了会议还有个直播live,其实不是直播
- 钉钉的live指的是实时点播,不是走的rtmp
- 点播的方式,类似优酷那种体验,快进到哪儿就从哪儿开始加载
- 有类似缓冲的处理

### 总结

- 为啥是点播而不是直播
  - 场景不一样,钉钉作为办公套件,live是用来传达领导精神的,点播够用了
- 为啥用obs不用rtmp
  - 用obs可支持多种数据源,传输采用webrtc可支持会议类型
  - 其次rtmp并没有在钉钉领地中找到合适的应用场景(也可能是我用的太少)
  - 其次在其他产品追求显示更多视窗时,钉钉选择只显示一个
    - 协作沟通不是玩找茬打游戏,这点我个人非常赞同
    - 只显示一个,输入用obs来扩展,输出只考虑一个数据通道即可
    - 这样在实现上的复杂度就底了很多.这也是摄像头和屏幕共享的参数一致的原因
    - 从这里就可以看出,钉钉有个非常牛的项目经理
- 用合适的技术来解决业务问题,钉钉做的是相当棒的,产品经理点赞+1w
- 钉钉号称单会议支持302,我没有测试过,不好做评价
  - 其他团队测试的结果是6人就与卡顿
  - 估计是和多点部署媒体服务有关,毕竟钉钉是综合协作工具,不仅仅包含会议

最后,因为我测试的不充分,很多没聊到,是因为没测试到.
初步分析后,产品经理和项目经理都做的非常出色,
比我之前预估的高出2个等级,钉钉能夺得魁首,理所应当.

## webex meet

因为账号难弄,所以讲官网产品手册上的部分内容做下解读,
为啥不解读其他产品的?因为解读假东西没有任何意义.

- 首先webex 是支持webrtc的,硬件部分不在讨论范围之内
- 免费的产品,单会议支持50方,付费的另说
- 产品功能除了会议,还有录制和屏幕共享,这点中规中矩
- 单媒体服务系统支撑的人数有限,升级版会高一个数量集
  - 所以大规模,还是靠集群
  - 这里有个前提就是单一会议的无缝体验
  - 这就是常说的两点:"就近接入" + "智能路由"(这也是英特尔提出的感染模型)
  - 这也是会议中的核心部分,重要程度就是cdn对于直播的概念
  - 从文档上看,一台升级版支持700并发,一个集群24台升级版
  - 单会议在单中心最多450并发
    - 可以算成6x6x12: 单中心支持12个最小单元(每个单元6个人)
    - 也可以算成7x7x9: 单中心支持9个最小单元(每个单元7个人)
    - 也可以试5x5x18
  - 对于webrtc还有特殊处理,单中心最多100个webrtc连接
    - 10x10x1
    - 5x5x4
- webex支持很多硬件设备,webrtc纯软件只占少数
  - webrtc 的编码格式是vp8/opus

## talkline

### talkline安装第一印象

- 不是采用cef的方式,但是采用的是qt的webkit
- 界面和功能都是基于qt完成的,毕竟打开offer等功能,qt支持的还是不错的

### talkline会议体验

- 第一,作为使用webrtc技术的视频会议产品,不能用浏览器访问,产品经理怎么考虑的
- 摄像头基本参数是360p/15fps/码率640kbps
- 屏幕共享参数是1080p/8fps/2500kbps
- 因为加密,所以不能确定用什么协议在传输,udp+dtls跑不掉了
- 会议分型链接也是走的"外部协议请求",走的是纯客户端模式
- 摄像头,资源占用6%,录制5%;屏幕10%,录制5%,这个成绩属于非常好的
- 录制的质量稍差

同样受限于账号和加密,无法看到更多的数据

有报告指出:6人会议会出现卡顿.目前免费的单会议支持100方,官网上写的是50方

最后,官网上写的200+的服务部署点,按理说不应该出现卡顿的.

## 瞩目

最后也是因为账号限制,无法进一步分析,webex 的账号申请还在审核中...
